(this.webpackJsonpcircuits=this.webpackJsonpcircuits||[]).push([[0],{12:function(t,n,e){"use strict";(function(t){var i=e(5),o=e(9),s=e(14),a=e(13),c=e(2),u=e(1),r=e(4),l=e(7),d=(e(24),e(3)),p=e.n(d),h=e(0),f="circuit-data",v=["e07800","0969d7","b80000","65a300","c31fff","9fb800","00e083"],y=function(){function t(n,e,i){Object(r.a)(this,t),this.position={x:0,y:0},this.state=0,this.id=n,this.position.x=e,this.position.y=i}return Object(l.a)(t,[{key:"value",get:function(){return this.state}},{key:"toggle",value:function(){0===this.state?this.state=1:this.state=0}}],[{key:"fromJS",value:function(n){var e=new t;return e.id=n.id,e.position=n.position,e.state=n.state,e}}]),t}(),j=function(){function t(n,e,i){Object(r.a)(this,t),this.position={x:0,y:0},this.state=0,this.id=n,this.position.x=e,this.position.y=i}return Object(l.a)(t,[{key:"value",get:function(){return this.state}}],[{key:"fromJS",value:function(n){var e=new t;return e.id=n.id,e.position=n.position,e.state=n.state,e}}]),t}(),g=1,b=function(){function t(n,e,i,o,s){var a=this;Object(r.a)(this,t),this.inputs=[],this.inputById={},this.outputs=[],this.outputById={},this.gates={},this.connections=new Set,this._inputId=0,this._outputId=0,this.position={x:0,y:0},this.id=g++,this.color=v[this.id%v.length];for(var c=0;c<n;++c){var l=new y("".concat(this.id,":i").concat(this._inputId++),0,0);this.inputById[l.id]=l,this.inputs.push(l.id)}for(var d=0;d<e;++d){var p=new j("".concat(this.id,":o").concat(this._outputId++),0,0);this.outputById[p.id]=p,this.outputs.push(p.id)}var h,f={},b=Object(u.a)(i);try{for(b.s();!(h=b.n()).done;){var O=h.value,m=new O.constructorClass;this.gates[m.id]=m,f[O.oldId]=m}}catch(S){b.e(S)}finally{b.f()}var I,x=Object(u.a)(o);try{for(x.s();!(I=x.n()).done;){var B=I.value,k=void 0,N="";"self-input"===B.source.type?k="".concat(this.id,":i").concat(B.source.oldIndex):"gate-output"===B.source.type?k="".concat(f[B.source.gateId].id,":").concat(B.source.nodeId):console.log("wtf???"),"self-output"===B.destination.type?N="".concat(this.id,":o").concat(B.destination.oldIndex):"gate-input"===B.destination.type?N="".concat(f[B.destination.gateId].id,":").concat(B.destination.nodeId):console.log("wtf???"),this.connections.add("".concat(k,"-").concat(N))}}catch(S){x.e(S)}finally{x.f()}s&&(this.evaluate=function(){return s(a)}),this.evaluate()}return Object(l.a)(t,[{key:"evaluate",value:function(){for(var t=this,n=0,e=Object.values(this.inputById);n<e.length;n++){var i=e[n];this.allDestinations(i.id).forEach((function(n){return t.updateNode(n)}))}}},{key:"addInput",value:function(t){var n=new y("".concat(this.id,":i").concat(this._inputId++),0,t);this.inputById[n.id]=n,this.inputs.push(n.id)}},{key:"addOutput",value:function(t){var n=new j("".concat(this.id,":o").concat(this._outputId++),0,t);this.outputById[n.id]=n,this.outputs.push(n.id)}},{key:"addGate",value:function(t,n,e){var i=new t(n,e);this.gates[i.id]=i}},{key:"addConnection",value:function(t,n){this.connections.add("".concat(t,"-").concat(n)),this.updateNode(n)}},{key:"removeInput",value:function(t){delete this.inputById[t],this.inputs.splice(this.inputs.indexOf(t),1);var n,e=new Set,i=Object(u.a)(this.connections);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=o.split("-"),a=Object(c.a)(s,2),r=a[0],l=a[1];r===t&&(this.connections.delete(o),e.add(l))}}catch(f){i.e(f)}finally{i.f()}var d,p=Object(u.a)(e);try{for(p.s();!(d=p.n()).done;){var h=d.value;this.updateNode(h)}}catch(f){p.e(f)}finally{p.f()}}},{key:"removeOutput",value:function(t){delete this.outputById[t],this.outputs.splice(this.outputs.indexOf(t),1);var n,e=Object(u.a)(this.allSources(t));try{for(e.s();!(n=e.n()).done;){var i=n.value;this.connections.delete("".concat(i,"-").concat(t))}}catch(o){e.e(o)}finally{e.f()}}},{key:"removeGate",value:function(t){for(var n=this,e=this.gates[t],i=function(){var t=s[o];n.allSources(t.id).forEach((function(e){n.connections.delete("".concat(e,"-").concat(t.id))}))},o=0,s=Object.values(e.inputById);o<s.length;o++)i();for(var a=function(){var t=u[c];n.allDestinations(t.id).forEach((function(e){n.connections.delete("".concat(t.id,"-").concat(e)),n.updateNode(e)}))},c=0,u=Object.values(e.outputById);c<u.length;c++)a();delete this.gates[t]}},{key:"allDestinations",value:function(t){var n,e=[],i=Object(u.a)(this.connections.values());try{for(i.s();!(n=i.n()).done;){var o=n.value.split("-"),s=Object(c.a)(o,2),a=s[0],r=s[1];a===t&&e.push(r)}}catch(l){i.e(l)}finally{i.f()}return e}},{key:"allSources",value:function(t){var n,e=[],i=Object(u.a)(this.connections.values());try{for(i.s();!(n=i.n()).done;){var o=n.value.split("-"),s=Object(c.a)(o,2),a=s[0];s[1]===t&&e.push(a)}}catch(r){i.e(r)}finally{i.f()}return e}},{key:"getSourceValue",value:function(t){var n=t.split(":"),e=Object(c.a)(n,1)[0];return this.gates[e]?this.gates[e].outputById[t].value:this.inputById[t]?this.inputById[t].value:(console.log("wtf???",t),0)}},{key:"updateNode",value:function(t){var n=t.split(":"),e=Object(c.a)(n,1)[0];this.gates[e]?this.updateGate(e):this.outputById[t]?this.updateOutput(t):console.log("wtf???",t)}},{key:"updateGate",value:function(t){var n,e=this.gates[t],i=Object(u.a)(e.inputs);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=e.inputById[o];s.state=0;var a,c=Object(u.a)(this.allSources(s.id));try{for(c.s();!(a=c.n()).done;){var r=a.value;if(1===this.getSourceValue(r)){s.state=1;break}}}catch(j){c.e(j)}finally{c.f()}}}catch(j){i.e(j)}finally{i.f()}e.evaluate();var l,d=Object(u.a)(e.outputs);try{for(d.s();!(l=d.n()).done;){var p,h=l.value,f=e.outputById[h],v=Object(u.a)(this.allDestinations(f.id));try{for(v.s();!(p=v.n()).done;){var y=p.value;this.updateNode(y)}}catch(j){v.e(j)}finally{v.f()}}}catch(j){d.e(j)}finally{d.f()}}},{key:"updateOutput",value:function(t){var n=this.outputById[t];n.state=0;var e,i=Object(u.a)(this.allSources(t));try{for(i.s();!(e=i.n()).done;){var o=e.value;if(1===this.getSourceValue(o)){n.state=1;break}}}catch(s){i.e(s)}finally{i.f()}}},{key:"transformToGate",value:function(t){for(var n=this.inputs.length,e=this.outputs.length,i=[],o=0,s=Object.values(this.gates);o<s.length;o++){var a=s[o];i.push({constructorClass:a.constructor,constructorName:a.constructor.staticName,oldId:a.id})}var r,l=[],d=Object(u.a)(this.connections);try{for(d.s();!(r=d.n()).done;){var p=r.value.split("-"),h=Object(c.a)(p,2),f=h[0],v=h[1],y={},j=f.split(":"),g=Object(c.a)(j,2),b=g[0],O=g[1],I=v.split(":"),x=Object(c.a)(I,2),B=x[0],k=x[1];this.inputById[f]?y.source={type:"self-input",nodeId:O,oldIndex:this.inputs.indexOf(f)}:this.gates[b]&&(y.source={type:"gate-output",nodeId:O,gateId:b}),this.outputById[v]?y.destination={type:"self-output",nodeId:O,oldIndex:this.outputs.indexOf(v)}:this.gates[B]&&(y.destination={type:"gate-input",nodeId:k,gateId:B}),l.push(y)}}catch(N){d.e(N)}finally{d.f()}return m(t,n,e,i,l)}},{key:"toJS",value:function(){return{inputs:this.inputs,inputById:this.inputById,outputs:this.outputs,outputById:this.outputById,gates:this.gates,connections:Array.from(this.connections),_inputId:this._inputId,_outputId:this._outputId,position:this.position}}},{key:"fromJS",value:function(t){var n=this;this.inputs=t.inputs,this.inputById=Object.values(t.inputById).reduce((function(t,n){return t[n.id]=y.fromJS(n),t}),{}),this.outputs=t.outputs,this.outputById=Object.values(t.outputById).reduce((function(t,n){return t[n.id]=j.fromJS(n),t}),{}),this.connections=new Set(t.connections),this._inputId=t._inputId,this._outputId=t._outputId,this.position=t.position,this.gates=Object.values(t.gates).reduce((function(t,n){var e=T.concat(D).find((function(t){return t.classPointer.staticName===n.name}));if(e){var i=new e.classPointer(n.position.x,n.position.y);t[i.id]=i}return t}),{}),Object.values(this.gates).forEach((function(t){n.updateGate(t.id)}))}}]),t}(),O=0,m=function(t,n,e,i,o,c){var u,l,d=JSON.stringify({name:t,inputs:n,outputs:e,gates:i,connections:o}),p=(l=u=function(u){Object(s.a)(d,u);var l=Object(a.a)(d);function d(){var s,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(r.a)(this,d),(s=l.call(this,n,e,i,o,c)).name=t,s.position.x=a,s.position.y=u,s}return d}(b),u.initialArgs=d,u.color=v[O++%v.length],l);return p.staticName=t,p},I=function(t){var n=t.input,e=(t.connections,Object(o.a)(t,["input","connections"]));return Object(h.jsx)("div",Object(i.a)(Object(i.a)({id:n.id},e),{},{className:"circuit-input ".concat(1===n.value?"circuit-input-on":""),style:{left:n.position.x,top:n.position.y}}))},x=function(t){var n=t.output,e=(t.connections,Object(o.a)(t,["output","connections"]));return Object(h.jsx)("div",Object(i.a)(Object(i.a)({id:n.id},e),{},{className:"circuit-output ".concat(1===n.value?"circuit-output-on":""),style:{right:n.position.x,top:n.position.y}}))},B=function(t){var n=t.gate,e=(t.connections,t.onConnectionMade),i=t.onRemove;return Object(h.jsxs)("div",{id:n.id,className:"circuit-gate circuit-gate-".concat(n.type),style:{left:n.position.x,top:n.position.y,background:"#".concat(n.constructor.color)},onClick:function(t){t.shiftKey&&(P.removeGate(n.id),i(),t.stopPropagation())},onTouchStart:function(t){t.shiftKey&&(P.removeGate(n.id),i(),t.stopPropagation())},onMouseDown:function(t){E||(E={gateId:n.id,startMousePos:{x:t.clientX,y:t.clientY},startGatePos:{x:n.position.x,y:n.position.y}})},onTouchMove:function(t){E||(E={gateId:n.id,startMousePos:{x:t.touches[0].clientX,y:t.touches[0].clientY},startGatePos:{x:n.position.x,y:n.position.y}})},children:[Object(h.jsx)("div",{className:"circuit-gate-inputs",children:Object.values(n.inputById).map((function(t){return Object(h.jsx)("div",{id:t.id,className:"circuit-gate-input ".concat(1===t.value?"circuit-gate-input-on":""),onMouseUp:function(){M&&e(M,t.id),M=null},onTouchEnd:function(){M&&e(M,t.id),M=null}},t.id)}))}),Object(h.jsx)("div",{className:"circuit-gate-name",children:n.name}),Object(h.jsx)("div",{className:"circuit-gate-outputs",children:Object.values(n.outputById).map((function(t){return Object(h.jsx)("div",{id:t.id,className:"circuit-gate-output ".concat(1===t.value?"circuit-gate-output-on":""),onMouseDown:function(n){M||(M=t.id,n.stopPropagation())},onTouchStart:function(n){M||(M=t.id,n.stopPropagation())}},t.id)}))})]})},k=function(n){var e,i,o,s,a=n.start,u=n.end,r=n.complete,l=void 0!==r&&r,d=p.a.useState(),f=Object(c.a)(d,2)[1],v=p.a.useCallback((function(){f({})}),[]);p.a.useEffect((function(){t(v)}),[]);var y=document.getElementById(a),j=document.getElementById(u);if(l){if(!y||!j)return null;var g=y.getBoundingClientRect(),b=j.getBoundingClientRect();e=g.x+g.width/2,i=g.y+g.height/2,o=b.x+b.width/2,s=b.y+b.height/2}else{if(!y)return null;var O=y.getBoundingClientRect();e=O.x+O.width/2,i=O.y+O.height/2,o=J.x,s=J.y}return Object(h.jsx)("line",{x1:e,y1:i,x2:o,y2:s})},N=function(){try{var t=JSON.stringify({circuit:P.toJS(),customGates:D.map((function(t){return t.classPointer.initialArgs}))});localStorage.setItem(f,t)}catch(n){console.log(n)}};var S=function(){try{var t=localStorage.getItem(f);if(t){var n,e=JSON.parse(t),i=e.customGates.map((function(t){return JSON.parse(t)})),o=Object(u.a)(i);try{for(o.s();!(n=o.n()).done;){var s=n.value,a=m(s.name,s.inputs,s.outputs,s.gates.map((function(t){var n=T.concat(D).find((function(n){return n.classPointer.staticName===t.constructorName}));return n&&(t.constructorClass=n.classPointer),t})),s.connections);D.push({name:s.name,classPointer:a,id:_++})}}catch(c){o.e(c)}finally{o.f()}P.fromJS(e.circuit)}}catch(r){console.log(r)}},w=(function(t,n){var e}(N),m("BASE",0,0,[],[])),P=new w,C=m("AND",2,1,[],[],(function(t){var n=t.inputById[t.inputs[0]],e=t.inputById[t.inputs[1]],i=t.outputById[t.outputs[0]];1===n.value&&1===e.value?i.state=1:i.state=0})),G=m("NOT",1,1,[],[],(function(t){var n=t.inputById[t.inputs[0]],e=t.outputById[t.outputs[0]];1===n.value?e.state=0:e.state=1})),M=null,E=null,J={x:0,y:0},_=1,T=[{classPointer:C,name:"AND",id:_++},{classPointer:G,name:"NOT",id:_++}],D=[];n.a=function(){var t=p.a.useState(),n=Object(c.a)(t,2)[1],e=p.a.useCallback((function(){n({})}),[]),i=function(t,n){P.addConnection(t,n),e()};return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsxs)("div",{className:"circuit",onMouseUp:function(){M=null,E=null,e()},onTouchEnd:function(){M=null,E=null,e()},onMouseMove:function(t){if(M&&(J.x=t.clientX,J.y=t.clientY,e()),E){var n=t.clientX-E.startMousePos.x,i=t.clientY-E.startMousePos.y,o=E.startGatePos.x+n,s=E.startGatePos.y+i;P.gates[E.gateId].position.x=o,P.gates[E.gateId].position.y=s,e()}},onTouchMove:function(t){if(M&&(J.x=t.touches[0].clientX,J.y=t.touches[0].clientY,e()),E){var n=t.touches[0].clientX-E.startMousePos.x,i=t.touches[0].clientY-E.startMousePos.y,o=E.startGatePos.x+n,s=E.startGatePos.y+i;P.gates[E.gateId].position.x=o,P.gates[E.gateId].position.y=s,e()}},children:[Object(h.jsx)("div",{className:"circuit-inputs",onClick:function(t){P.addInput(t.clientY-20),e()},children:Object.values(P.inputById).map((function(t){return Object(h.jsx)(I,{input:t,connections:P.connections,onClick:function(n){n.shiftKey?P.removeInput(t.id):(t.toggle(),P.allDestinations(t.id).forEach((function(t){return P.updateNode(t)}))),n.stopPropagation(),e()},onMouseDown:function(){M||(M=t.id)},onTouchStart:function(){M||(M=t.id)}},t.id)}))}),Object(h.jsx)("div",{className:"circuit-outputs",onClick:function(t){P.addOutput(t.clientY-20),e()},children:Object.values(P.outputById).map((function(t){return Object(h.jsx)(x,{output:t,connections:P.connections,onClick:function(n){n.shiftKey&&P.removeOutput(t.id),e()},onMouseUp:function(){M&&i(M,t.id),M=null},onTouchEnd:function(){M&&i(M,t.id),M=null}},t.id)}))}),Object.values(P.gates).map((function(t){return Object(h.jsx)(B,{gate:t,connections:P.connections,onConnectionMade:i,onRemove:function(){return e()}},t.id)})),Object(h.jsxs)("svg",{children:[Array.from(P.connections).map((function(t){var n=t.split("-"),e=Object(c.a)(n,2),i=e[0],o=e[1];return Object(h.jsx)(k,{complete:!0,start:i,end:o},t)})),M&&Object(h.jsx)(h.Fragment,{children:Object(h.jsx)(k,{start:M})})]})]}),Object(h.jsxs)("div",{className:"tools",children:[Object(h.jsxs)("div",{className:"tools-save",children:[Object(h.jsx)("input",{id:"gate-name",className:"tools-save-name",placeholder:"New gate name"}),Object(h.jsx)("button",{className:"tools-save-submit",onClick:function(t){var n=document.getElementById("gate-name");if(n.value.length){var i=P.transformToGate(n.value);D.push({name:n.value,classPointer:i,id:_++}),n.value="",P=new w,e()}},children:"Create"})]}),Object(h.jsxs)("div",{className:"tools-gates",children:[T.map((function(t){return Object(h.jsx)("button",{className:"tools-gate",style:{background:"#".concat(t.classPointer.color)},onClick:function(n){P.addGate(t.classPointer,50,20),e()},children:t.name},t.name)})),D.map((function(t){return Object(h.jsx)("button",{className:"tools-gate",style:{background:"#".concat(t.classPointer.color)},onClick:function(n){P.addGate(t.classPointer,50,20),e()},children:t.name},t.name)}))]})]}),Object(h.jsxs)("div",{className:"state-manager",children:[Object(h.jsx)("br",{}),Object(h.jsx)("button",{onClick:function(){P=new w,e()},children:"Reset Current Curcuit"}),Object(h.jsx)("button",{onClick:function(){localStorage.removeItem(f),window.location.reload()},children:"Reset Whole State"}),Object(h.jsx)("br",{}),"(buggy atm):",Object(h.jsx)("button",{onClick:function(){N()},children:"Save State"}),Object(h.jsx)("button",{onClick:function(){S(),e()},children:"Load State"})]})]})}}).call(this,e(21).setImmediate)},15:function(t,n,e){"use strict";e.r(n);var i=e(3),o=e.n(i),s=e(11),a=e.n(s),c=(e(20),e(12)),u=e(0);a.a.render(Object(u.jsx)(o.a.StrictMode,{children:Object(u.jsx)(c.a,{})}),document.getElementById("root"))},20:function(t,n,e){},24:function(t,n,e){}},[[15,1,2]]]);
//# sourceMappingURL=main.923d624c.chunk.js.map